<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Productos - Oskandre</title>

    <style>
        /* (*** CSS EXISTENTE - SIN CAMBIOS SIGNIFICATIVOS AQU ***) */
        body {
            font-family: Arial, sans-serif;
            background: #f3e5d8;
            margin: 0;
            padding: 0;
        }

        header {
            background: #4a2c16;
            padding: 20px;
            text-align: center;
        }

        header h1 {
            color: white;
            margin: 0;
        }

        nav {
            text-align: center;
            background: #6f4e37;
            padding: 10px 0;
        }

        nav a {
            color: white;
            text-decoration: none;
            margin: 0 20px;
            font-weight: bold;
        }

        nav a:hover {
            color: #f8d7a3;
        }

        .productos {
            padding: 40px;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 30px;
        }

        .producto {
            background: white;
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            position: relative; /* Para posicionar el stock */
        }

        .producto img {
            width: 100%;
            height: 220px;
            object-fit: cover;
            border-radius: 12px;
        }

        .producto h3 {
            margin-top: 15px;
            font-size: 22px;
            color: #4a2c16;
        }

        .precio {
            font-size: 20px;
            color: #6f4e37;
            margin: 10px 0;
            font-weight: bold;
        }

        .stock {
            font-size: 14px;
            color: #b06e40;
            margin-bottom: 10px;
            font-weight: bold;
        }
        
        /* Nuevo estilo para producto agotado */
        .agotado {
            opacity: 0.6;
            border: 2px solid red;
        }

        .btn-comprar {
            background: #4a2c16;
            color: white;
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: 0.3s ease;
        }

        .btn-comprar:hover:not(:disabled) {
            background: #6f4e37;
        }
        
        .btn-comprar:disabled {
            background: #aaa;
            cursor: not-allowed;
        }

        .carrito-notificacion {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #4a2c16;
            color: white;
            padding: 12px 20px;
            border-radius: 10px;
            display: none;
            font-size: 18px;
            z-index: 100;
        }
        
        /* Estilos del formulario de agregar */
        #formulario-agregar {
            background: white;
            padding: 20px;
            margin: 20px 40px;
            border-radius: 12px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
        }

        #formulario-agregar input, #formulario-agregar button {
            display: block;
            width: 100%;
            padding: 10px;
            margin-bottom: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
        }

        #formulario-agregar button {
            background: #6f4e37;
            color: white;
            cursor: pointer;
            font-weight: bold;
        }
    </style>
</head>
<body>

    <header>
        <h1>Productos</h1>
    </header>

    <nav>
        <a href="index.html">Inicio</a>
        <a href="productos.html">Productos</a>
        <a href="nosotros.html">Nosotros</a>
        <a href="contacto.html">Contacto</a>
        <a href="carrito.html"> Carrito</a>
    </nav>
    
    <div id="formulario-agregar">
        <h2>A帽adir Nuevo Producto (Admin)</h2>
        <input type="text" id="nombre-input" placeholder="Nombre del Producto" required>
        <input type="number" id="precio-input" placeholder="Precio (MXN)" required min="1">
        <input type="number" id="stock-input" placeholder="Stock Inicial" required min="1">
        <input type="text" id="imagen-input" placeholder="Ruta de Imagen (ej: oskandre/nueva.jpg)">
        <button onclick="agregarNuevoProducto()">Agregar Producto</button>
    </div>

    <div class="productos" id="contenedor-productos">
        </div>

    <div id="notificacion" class="carrito-notificacion"></div>

    <script>
        // 1. Array de Productos con Stock (Simulaci贸n de Base de Datos)
        // Usamos localStorage para que persista el stock y los productos agregados
        let productos = JSON.parse(localStorage.getItem('inventarioProductos')) || [
            { id: 1, nombre: 'Caf茅 en Bolsitas', precio: 120, imagen: 'oskandre/Bolsitas.jpg', stock: 10 },
            { id: 2, nombre: 'Caf茅 de Chiapas', precio: 160, imagen: 'oskandre/cafeDeChiapas.jpg', stock: 5 },
            { id: 3, nombre: 'Vinagre Natural', precio: 90, imagen: 'oskandre/Vinagre.jpg', stock: 20 },
            { id: 4, nombre: 'Vinagre de Manzana', precio: 110, imagen: 'oskandre/vinagreDeManzana.jpg', stock: 8 }
        ];

        // Funci贸n para guardar los productos en localStorage
        function guardarProductos() {
            localStorage.setItem('inventarioProductos', JSON.stringify(productos));
        }
        
        // 2. Funci贸n para renderizar los productos en la interfaz
        function renderizarProductos() {
            const contenedor = document.getElementById('contenedor-productos');
            contenedor.innerHTML = ''; // Limpiar el contenedor
            
            productos.forEach(p => {
                const stockTexto = p.stock > 0 ? `Stock: ${p.stock}` : '隆Agotado!';
                const estaAgotado = p.stock <= 0;
                
                // Crea el elemento div.producto
                const productoDiv = document.createElement('div');
                productoDiv.classList.add('producto');
                if (estaAgotado) {
                    productoDiv.classList.add('agotado');
                }
                
                productoDiv.innerHTML = `
                    <img src="${p.imagen}" alt="${p.nombre}">
                    <h3>${p.nombre}</h3>
                    <p class="precio">$${p.precio} MXN</p>
                    <p class="stock" id="stock-${p.id}">${stockTexto}</p>
                    <button class="btn-comprar" 
                            onclick="agregarCarrito(${p.id}, '${p.nombre}', ${p.precio})" 
                            ${estaAgotado ? 'disabled' : ''}>
                        Comprar
                    </button>
                `;
                contenedor.appendChild(productoDiv);
            });
        }
        
        // 3. Funci贸n para agregar nuevo producto (para el formulario de Admin)
        function agregarNuevoProducto() {
            const nombre = document.getElementById('nombre-input').value;
            const precio = parseFloat(document.getElementById('precio-input').value);
            const stock = parseInt(document.getElementById('stock-input').value);
            const imagen = document.getElementById('imagen-input').value || 'oskandre/default.jpg'; // Usa una imagen por defecto si no se da una
            
            if (!nombre || isNaN(precio) || isNaN(stock) || precio <= 0 || stock <= 0) {
                alert('Por favor, ingresa un nombre, un precio v谩lido y un stock v谩lido.');
                return;
            }

            const nuevoId = productos.length > 0 ? productos[productos.length - 1].id + 1 : 1;

            productos.push({
                id: nuevoId,
                nombre: nombre,
                precio: precio,
                imagen: imagen,
                stock: stock
            });
            
            guardarProductos();
            renderizarProductos();
            alert(`Producto "${nombre}" agregado con 茅xito.`);
            
            // Limpiar el formulario
            document.getElementById('nombre-input').value = '';
            document.getElementById('precio-input').value = '';
            document.getElementById('stock-input').value = '';
            document.getElementById('imagen-input').value = '';
        }


        // 4. Funci贸n de Carrito Actualizada (Manejo de Stock)
        function agregarCarrito(id, nombre, precio) {
            let productoIndex = productos.findIndex(p => p.id === id);

            if (productoIndex !== -1 && productos[productoIndex].stock > 0) {
                // a. Disminuir el Stock
                productos[productoIndex].stock--;
                guardarProductos();

                // b. Actualizar el DOM (el texto de stock)
                const stockElement = document.getElementById(`stock-${id}`);
                stockElement.textContent = `Stock: ${productos[productoIndex].stock}`;
                
                if (productos[productoIndex].stock === 0) {
                    // Si se agota, volver a renderizar para deshabilitar el bot贸n y poner el estilo de agotado
                    renderizarProductos(); 
                }

                // c. Agregar al carrito de compras (como ya lo ten铆as)
                let carrito = JSON.parse(localStorage.getItem("carrito")) || [];
                carrito.push({ id, nombre, precio });
                localStorage.setItem("carrito", JSON.stringify(carrito));

                // d. Mostrar notificaci贸n
                const notif = document.getElementById("notificacion");
                notif.textContent = `"${nombre}" agregado. Quedan ${productos[productoIndex].stock}.`;
                notif.style.display = "block";

                setTimeout(() => {
                    notif.style.display = "none";
                }, 2000);
                
            } else {
                alert('Lo sentimos, este producto est谩 agotado.');
            }
        }
        
        // Ejecutar la funci贸n para mostrar los productos al cargar la p谩gina
        document.addEventListener('DOMContentLoaded', renderizarProductos);
    </script>

</body>
</html>
