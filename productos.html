<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Productos - Oskandre</title>

    <style>
        /* Estilos Generales */
        body {
            font-family: Arial, sans-serif;
            background: #f3e5d8;
            margin: 0;
            padding: 0;
        }

        header {
            background: #4a2c16;
            padding: 20px;
            text-align: center;
        }

        header h1 {
            color: white;
            margin: 0;
        }

        nav {
            text-align: center;
            background: #6f4e37;
            padding: 10px 0;
        }

        nav a {
            color: white;
            text-decoration: none;
            margin: 0 20px;
            font-weight: bold;
        }

        nav a:hover {
            color: #f8d7a3;
        }

        /* Grid de Productos */
        .productos {
            padding: 40px;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 30px;
        }

        /* Tarjeta de Producto */
        .producto {
            background: white;
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            position: relative;
        }

        .producto img {
            width: 100%;
            height: 220px;
            object-fit: cover;
            border-radius: 12px;
        }

        .producto h3 {
            margin-top: 15px;
            font-size: 22px;
            color: #4a2c16;
        }

        .precio {
            font-size: 20px;
            color: #6f4e37;
            margin: 10px 0;
            font-weight: bold;
        }

        .stock {
            font-size: 14px;
            color: #b06e40;
            margin-bottom: 10px;
            font-weight: bold;
        }
        
        .agotado {
            opacity: 0.6;
            border: 2px solid red;
        }

        /* Botones */
        .btn-comprar {
            background: #4a2c16;
            color: white;
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: 0.3s ease;
            margin-top: 5px;
            width: 100%;
        }

        .btn-comprar:hover:not(:disabled) {
            background: #6f4e37;
        }
        
        .btn-comprar:disabled {
            background: #aaa;
            cursor: not-allowed;
        }

        .btn-eliminar {
            background: #dc3545;
            color: white;
            padding: 8px 15px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            transition: 0.3s ease;
            font-size: 14px;
            margin-top: 10px;
            width: 100%;
        }

        .btn-eliminar:hover {
            background: #c82333;
        }

        /* Notificaci贸n de Carrito */
        .carrito-notificacion {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #4a2c16;
            color: white;
            padding: 12px 20px;
            border-radius: 10px;
            display: none;
            font-size: 18px;
            z-index: 100;
        }
        
        /* Formulario de Administraci贸n */
        #formulario-agregar {
            background: white;
            padding: 20px;
            margin: 20px 40px;
            border-radius: 12px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
        }

        #formulario-agregar input:not([type="file"]), 
        #formulario-agregar button {
            display: block;
            width: 100%;
            padding: 10px;
            margin-bottom: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
        }

        #formulario-agregar input[type="file"] {
             margin-bottom: 10px;
             border: 1px solid #ccc;
             padding: 10px;
             border-radius: 4px;
        }

        #formulario-agregar label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #4a2c16;
        }

        #formulario-agregar button {
            background: #6f4e37;
            color: white;
            cursor: pointer;
            font-weight: bold;
        }
    </style>
</head>
<body>

    <header>
        <h1>Productos</h1>
    </header>

    <nav>
        <a href="index.html">Inicio</a>
        <a href="productos.html">Productos</a>
        <a href="nosotros.html">Nosotros</a>
        <a href="contacto.html">Contacto</a>
        <a href="carrito.html"> Carrito</a>
    </nav>
    
    <div id="formulario-agregar">
        <h2>A帽adir/Administrar Productos (Admin)</h2>
        <input type="text" id="nombre-input" placeholder="Nombre del Producto" required>
        <input type="number" id="precio-input" placeholder="Precio (MXN)" required min="1">
        <input type="number" id="stock-input" placeholder="Stock Inicial" required min="1">
        
        <label for="imagen-file-input">Seleccionar Imagen (Simulaci贸n de Subida):</label>
        <input type="file" id="imagen-file-input" accept="image/*">
        
        <button onclick="agregarNuevoProducto()">Agregar Producto</button>
    </div>

    <div class="productos" id="contenedor-productos">
        </div>

    <div id="notificacion" class="carrito-notificacion"></div>

    <script>
        // Inicializaci贸n del Inventario usando localStorage para persistencia
        let productos = JSON.parse(localStorage.getItem('inventarioProductos')) || [
            // Productos iniciales si no hay nada guardado en localStorage
            { id: 1, nombre: 'Caf茅 en Bolsitas', precio: 120, imagen: 'oskandre/Bolsitas.jpg', stock: 10 },
            { id: 2, nombre: 'Caf茅 de Chiapas', precio: 160, imagen: 'oskandre/cafeDeChiapas.jpg', stock: 5 },
            { id: 3, nombre: 'Vinagre Natural', precio: 90, imagen: 'oskandre/Vinagre.jpg', stock: 20 },
            { id: 4, nombre: 'Vinagre de Manzana', precio: 110, imagen: 'oskandre/vinagreDeManzana.jpg', stock: 8 }
        ];

        // Guarda el array de productos en localStorage
        function guardarProductos() {
            localStorage.setItem('inventarioProductos', JSON.stringify(productos));
        }
        
        // Renderiza (dibuja) todos los productos en la interfaz
        function renderizarProductos() {
            const contenedor = document.getElementById('contenedor-productos');
            contenedor.innerHTML = ''; // Limpiar el contenedor antes de dibujar

            productos.forEach(p => {
                const stockTexto = p.stock > 0 ? `Stock: ${p.stock}` : '隆Agotado!';
                const estaAgotado = p.stock <= 0;
                
                const productoDiv = document.createElement('div');
                productoDiv.classList.add('producto');
                if (estaAgotado) {
                    productoDiv.classList.add('agotado');
                }
                
                productoDiv.innerHTML = `
                    <img src="${p.imagen}" alt="${p.nombre}">
                    <h3>${p.nombre}</h3>
                    <p class="precio">$${p.precio} MXN</p>
                    <p class="stock" id="stock-${p.id}">${stockTexto}</p>
                    <button class="btn-comprar" 
                            onclick="agregarCarrito(${p.id})" 
                            ${estaAgotado ? 'disabled' : ''}>
                        Comprar
                    </button>
                    <button class="btn-eliminar" onclick="eliminarProducto(${p.id}, '${p.nombre}')">
                        Eliminar Producto
                    </button>
                `;
                contenedor.appendChild(productoDiv);
            });
        }
        
        // Funci贸n para agregar un nuevo producto desde el formulario
        function agregarNuevoProducto() {
            const nombre = document.getElementById('nombre-input').value;
            const precio = parseFloat(document.getElementById('precio-input').value);
            const stock = parseInt(document.getElementById('stock-input').value);
            const imagenFile = document.getElementById('imagen-file-input').files[0];

            if (!nombre || isNaN(precio) || isNaN(stock) || precio <= 0 || stock <= 0) {
                alert('Por favor, ingresa un nombre, un precio v谩lido y un stock v谩lido.');
                return;
            }

            let imagenURL = 'oskandre/default.jpg'; // Ruta por defecto
            
            // Simulaci贸n de subida: obtiene una URL temporal del archivo seleccionado
            if (imagenFile) {
                imagenURL = URL.createObjectURL(imagenFile);
            }

            const nuevoId = productos.length > 0 ? productos[productos.length - 1].id + 1 : 1;

            productos.push({
                id: nuevoId,
                nombre: nombre,
                precio: precio,
                imagen: imagenURL,
                stock: stock
            });
            
            guardarProductos();
            renderizarProductos();
            alert(`Producto "${nombre}" agregado con 茅xito.`);
            
            // Limpiar el formulario
            document.getElementById('nombre-input').value = '';
            document.getElementById('precio-input').value = '';
            document.getElementById('stock-input').value = '';
            document.getElementById('imagen-file-input').value = '';
        }

        // Funci贸n para eliminar un producto
        function eliminarProducto(id, nombre) {
            if (confirm(`驴Est谩s seguro de que quieres ELIMINAR el producto: "${nombre}"? Esta acci贸n es permanente.`)) {
                
                // Busca el producto para liberar la URL temporal si es necesario
                const productoEliminado = productos.find(p => p.id === id);
                
                // Filtra el array, excluyendo el producto con el ID dado
                productos = productos.filter(p => p.id !== id);
                
                guardarProductos();
                renderizarProductos();
                
                // Libera la URL temporal de la imagen si se hab铆a subido un archivo
                if (productoEliminado && productoEliminado.imagen.startsWith('blob:')) {
                    URL.revokeObjectURL(productoEliminado.imagen);
                }
                
                alert(`Producto "${nombre}" eliminado correctamente.`);
            }
        }


        // Funci贸n principal para agregar un producto al carrito y gestionar el stock
        function agregarCarrito(id) {
            let productoIndex = productos.findIndex(p => p.id === id);
            const producto = productos[productoIndex];

            if (productoIndex !== -1 && producto.stock > 0) {
                // 1. Disminuir el Stock
                producto.stock--;
                guardarProductos();

                // 2. Actualizar la vista (DOM) del stock
                const stockElement = document.getElementById(`stock-${producto.id}`);
                stockElement.textContent = `Stock: ${producto.stock}`;
                
                if (producto.stock === 0) {
                    renderizarProductos(); // Volver a renderizar para deshabilitar el bot贸n y aplicar el estilo "agotado"
                }

                // 3. Agregar al carrito (usando localStorage)
                let carrito = JSON.parse(localStorage.getItem("carrito")) || [];
                carrito.push({ id: producto.id, nombre: producto.nombre, precio: producto.precio });
                localStorage.setItem("carrito", JSON.stringify(carrito));

                // 4. Mostrar notificaci贸n
                const notif = document.getElementById("notificacion");
                notif.textContent = `"${producto.nombre}" agregado. Quedan ${producto.stock}.`;
                notif.style.display = "block";

                setTimeout(() => {
                    notif.style.display = "none";
                }, 2000);
                
            } else {
                alert('Lo sentimos, este producto est谩 agotado.');
            }
        }
        
        // Ejecutar la funci贸n para mostrar los productos al cargar la p谩gina
        document.addEventListener('DOMContentLoaded', renderizarProductos);
    </script>

</body>
</html>
